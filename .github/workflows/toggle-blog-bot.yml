name: Toggle AI Blog Bot

on:
  workflow_dispatch:
    inputs:
      action:
        description: "Pause or resume the blog bot"
        required: true
        type: choice
        options:
          - pause
          - resume
        default: pause

# Needed to create/update repository variables with GITHUB_TOKEN
permissions:
  actions: write
  contents: read

jobs:
  toggle:
    runs-on: ubuntu-latest
    steps:
      - name: Set BLOG_BOT_PAUSED repository variable
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;
            const name = 'BLOG_BOT_PAUSED';
            const pause = core.getInput('action') === 'pause';
            const value = pause ? 'true' : 'false';
            try {
              // Try to update if it exists
              await github.request('PATCH /repos/{owner}/{repo}/actions/variables/{name}', {
                owner, repo, name, value
              });
              core.info(`Updated ${name} to ${value}`);
            } catch (err) {
              if (err.status === 404) {
                // Create if it doesn't exist
                await github.request('POST /repos/{owner}/{repo}/actions/variables', {
                  owner, repo, name, value
                });
                core.info(`Created ${name} with value ${value}`);
              } else {
                core.setFailed(`Failed to set variable: ${err.message}`);
              }
            }
      - name: Show current status
        run: |
          echo "Action: ${{ inputs.action }}"
          echo "Repository variable BLOG_BOT_PAUSED has been set accordingly."
